{"version":3,"file":"static/js/958.9e8e0c75.chunk.js","mappings":"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","sources":["../../node_modules/pgs-parser/dist/buffer.js","../../node_modules/pgs-parser/dist/index.js","../../node_modules/pgs-parser/dist/parser.js","../../node_modules/pgs-parser/dist/segment.js","../../node_modules/@babel/runtime/helpers/arrayLikeToArray.js","../../node_modules/@babel/runtime/helpers/classCallCheck.js","../../node_modules/@babel/runtime/helpers/createClass.js","../../node_modules/@babel/runtime/helpers/createForOfIteratorHelper.js","../../node_modules/@babel/runtime/helpers/regeneratorRuntime.js","../../node_modules/@babel/runtime/helpers/toPrimitive.js","../../node_modules/@babel/runtime/helpers/toPropertyKey.js","../../node_modules/@babel/runtime/helpers/typeof.js","../../node_modules/@babel/runtime/helpers/unsupportedIterableToArray.js","../../node_modules/@babel/runtime/regenerator/index.js","../webpack/bootstrap","../webpack/runtime/compat get default export","../webpack/runtime/define property getters","../webpack/runtime/hasOwnProperty shorthand","../../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js","../../common/subtitle-reader/pgs-parser-worker.ts"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.BufferReader = exports.CompositeBufferReader = exports.CompositeBuffer = exports.Uint8ArrayBuffer = void 0;\nclass Uint8ArrayBuffer {\n    constructor(buffer) {\n        this.buffer = buffer;\n    }\n    get length() {\n        return this.buffer.length;\n    }\n    at(index) {\n        return this.buffer[index];\n    }\n    subarray(start, end) {\n        return new Uint8ArrayBuffer(this.buffer.subarray(start, end));\n    }\n}\nexports.Uint8ArrayBuffer = Uint8ArrayBuffer;\nclass CompositeBuffer {\n    constructor(buffers) {\n        this.buffers = [];\n        this.buffers = buffers;\n    }\n    get length() {\n        let length = 0;\n        for (const b of this.buffers) {\n            length += b.length;\n        }\n        return length;\n    }\n    at(index) {\n        let previousBuffersLength = 0;\n        for (const buffer of this.buffers) {\n            const bufferIndex = index - previousBuffersLength;\n            if (bufferIndex < buffer.length) {\n                return buffer.at(bufferIndex);\n            }\n            previousBuffersLength += buffer.length;\n        }\n        throw new Error('Out of bounds');\n    }\n    subarray(start, end) {\n        const chunks = [];\n        let previousBuffersLength = 0;\n        for (const buffer of this.buffers) {\n            const startBufferIndex = Math.max(0, start - previousBuffersLength);\n            const endBufferIndex = Math.min(buffer.length, end - previousBuffersLength);\n            if (endBufferIndex > 0 && startBufferIndex < endBufferIndex) {\n                chunks.push(buffer.subarray(startBufferIndex, endBufferIndex));\n            }\n            previousBuffersLength += buffer.length;\n        }\n        return new CompositeBuffer(chunks);\n    }\n}\nexports.CompositeBuffer = CompositeBuffer;\nclass CompositeBufferReader {\n    constructor() {\n        this.buffers = [];\n    }\n    add(buffer) {\n        this.buffers.push(buffer);\n    }\n    get length() {\n        let length = 0;\n        for (const buffer of this.buffers) {\n            length += buffer.length;\n        }\n        return length;\n    }\n    read(bytes) {\n        if (bytes === 0) {\n            return new CompositeBuffer([]);\n        }\n        const chunks = [];\n        let accumulated = 0;\n        while (true) {\n            if (this.buffers.length === 0) {\n                throw new Error('Trying to read more bytes than available');\n            }\n            const buffer = this.buffers.shift();\n            const required = bytes - accumulated;\n            if (buffer.length === required) {\n                chunks.push(buffer);\n                break;\n            }\n            else if (buffer.length > required) {\n                chunks.push(buffer.subarray(0, required));\n                this.buffers.unshift(buffer.subarray(required, buffer.length));\n                break;\n            }\n            accumulated += buffer.length;\n            chunks.push(buffer);\n        }\n        return new CompositeBuffer(chunks.map(c => new Uint8ArrayBuffer(c)));\n    }\n}\nexports.CompositeBufferReader = CompositeBufferReader;\nclass BufferReader {\n    constructor(bytes) {\n        this._index = 0;\n        this.buffer = bytes;\n    }\n    get index() {\n        return this._index;\n    }\n    get hasNext() {\n        return this._index < this.buffer.length;\n    }\n    readHex(bytes, limit) {\n        if (limit !== undefined && this._index + bytes > limit) {\n            return 0;\n        }\n        let number = 0;\n        let digit = 0;\n        const from = this._index;\n        const to = this._index + bytes - 1;\n        for (let i = to; i >= from; --i) {\n            number += this.buffer.at(i) << (8 * digit);\n            ++digit;\n        }\n        this._index += bytes;\n        return number;\n    }\n    readBuffer(bytes) {\n        const buffer = this.buffer.subarray(this.index, this.index + bytes);\n        this._index += bytes;\n        return buffer;\n    }\n}\nexports.BufferReader = BufferReader;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.LastInSequenceFlag = exports.CompositionState = exports.SegmentType = exports.DisplaySet = exports.parseDisplaySets = void 0;\nvar parser_1 = require(\"./parser\");\nObject.defineProperty(exports, \"parseDisplaySets\", { enumerable: true, get: function () { return parser_1.parseDisplaySets; } });\nObject.defineProperty(exports, \"DisplaySet\", { enumerable: true, get: function () { return parser_1.DisplaySet; } });\nvar segment_1 = require(\"./segment\");\nObject.defineProperty(exports, \"SegmentType\", { enumerable: true, get: function () { return segment_1.SegmentType; } });\nObject.defineProperty(exports, \"CompositionState\", { enumerable: true, get: function () { return segment_1.CompositionState; } });\nObject.defineProperty(exports, \"LastInSequenceFlag\", { enumerable: true, get: function () { return segment_1.LastInSequenceFlag; } });\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.DisplaySet = exports.parseDisplaySets = void 0;\nconst buffer_1 = require(\"./buffer\");\nconst segment_1 = require(\"./segment\");\nconst pgMagicNumber = 20551; // 0x5047\nfunction parseDisplaySets() {\n    const parser = new DisplaySetParser();\n    const accumulatedBuffer = new buffer_1.CompositeBufferReader();\n    let requestedBytes = 13;\n    return new TransformStream({\n        transform(chunk, controller) {\n            accumulatedBuffer.add(chunk);\n            while (accumulatedBuffer.length >= requestedBytes) {\n                requestedBytes = parser.consume(accumulatedBuffer.read(requestedBytes));\n                if (parser.ready) {\n                    controller.enqueue(parser.next());\n                }\n            }\n        },\n        flush(controller) {\n            if (parser.ready) {\n                controller.enqueue(parser.next());\n            }\n        },\n    });\n}\nexports.parseDisplaySets = parseDisplaySets;\nfunction rleDecode(encodedBuffer, callback) {\n    let encodedIndex = 0;\n    let decodedLineIndex = 0;\n    let currentLine = 0;\n    const encodedLength = encodedBuffer.length;\n    while (encodedIndex < encodedLength) {\n        const firstByte = encodedBuffer.at(encodedIndex);\n        let runLength;\n        let color;\n        let increment;\n        // Deal with each possible code\n        if (firstByte > 0) {\n            // CCCCCCCC\t- One pixel in color C\n            color = firstByte;\n            runLength = 1;\n            increment = 1;\n        }\n        else {\n            const secondByte = encodedBuffer.at(encodedIndex + 1);\n            if (secondByte === 0) {\n                // 00000000 00000000 - End of line\n                color = 0;\n                runLength = 0;\n                increment = 2;\n                decodedLineIndex = 0;\n                ++currentLine;\n            }\n            else if (secondByte < 64) {\n                // 00000000 00LLLLLL - L pixels in color 0 (L between 1 and 63)\n                color = 0;\n                runLength = secondByte;\n                increment = 2;\n            }\n            else if (secondByte < 128) {\n                // 00000000 01LLLLLL LLLLLLLL - L pixels in color 0 (L between 64 and 16383)\n                const thirdByte = encodedBuffer.at(encodedIndex + 2);\n                color = 0;\n                runLength = ((secondByte - 64) << 8) + thirdByte;\n                increment = 3;\n            }\n            else if (secondByte < 192) {\n                // 00000000 10LLLLLL CCCCCCCC - L pixels in color C (L between 3 and 63)\n                const thirdByte = encodedBuffer.at(encodedIndex + 2);\n                color = thirdByte;\n                runLength = secondByte - 128;\n                increment = 3;\n            }\n            else {\n                // 00000000 11LLLLLL LLLLLLLL CCCCCCCC - L pixels in color C (L between 64 and 16383)\n                const thirdByte = encodedBuffer.at(encodedIndex + 2);\n                const fourthByte = encodedBuffer.at(encodedIndex + 3);\n                color = fourthByte;\n                runLength = ((secondByte - 192) << 8) + thirdByte;\n                increment = 4;\n            }\n        }\n        if (runLength > 0) {\n            for (let x = decodedLineIndex; x < decodedLineIndex + runLength; ++x) {\n                callback(x, currentLine, color);\n            }\n            decodedLineIndex += runLength;\n        }\n        encodedIndex += increment;\n    }\n}\nclass DisplaySet {\n    constructor(presentationCompositionSegment, windowDefinitionSegments, paletteDefinitionSegments, objectDefinitionSegments, endDefinitionSegment, previousDisplaySet) {\n        this.presentationCompositionSegment = presentationCompositionSegment;\n        this.windowDefinitionSegments = windowDefinitionSegments;\n        this.paletteDefinitionSegments = paletteDefinitionSegments;\n        this.objectDefinitionSegments = objectDefinitionSegments;\n        this.endDefinitionSegment = endDefinitionSegment;\n        this.previousDisplaySet = previousDisplaySet;\n    }\n    get firstOds() {\n        return this.objectDefinitionSegments.find((ods) => ods.lastInSequenceFlag === segment_1.LastInSequenceFlag.firstInSequence ||\n            ods.lastInSequenceFlag === segment_1.LastInSequenceFlag.firstAndLastInSequence);\n    }\n    paletteDefinitionSegment(paletteId) {\n        const pds = this.paletteDefinitionSegments.find((s) => s.paletteId === paletteId);\n        if (pds === undefined) {\n            if (this.presentationCompositionSegment.compositionState !== segment_1.CompositionState.normal) {\n                throw new Error(`PCS references invalid PDS and composition state is not 'normal'`);\n            }\n            if (this.previousDisplaySet === undefined) {\n                throw new Error(`PCS references invalid PDS and no previous display set to fallback to`);\n            }\n            return this.previousDisplaySet.paletteDefinitionSegment(paletteId);\n        }\n        return pds;\n    }\n    imageData(buffer) {\n        const pds = this.paletteDefinitionSegment(this.presentationCompositionSegment.paletteId);\n        if (pds === undefined) {\n            throw new Error(`PCS references invalid PDS`);\n        }\n        const firstOds = this.firstOds;\n        if (firstOds === undefined || firstOds.width === undefined || firstOds.height === undefined) {\n            throw new Error(`Missing first ODS with defined width and height`);\n        }\n        const imageDataArray = buffer !== null && buffer !== void 0 ? buffer : new Uint8ClampedArray(firstOds.width * firstOds.height * 4);\n        const rgbaPalette = pds.paletteEntries.map((palette) => this.ycrcbToRgba(palette));\n        const width = firstOds.width;\n        rleDecode(new buffer_1.CompositeBuffer(this.objectDefinitionSegments.map((ods) => ods.objectData)), (x, y, paletteIndex) => {\n            const pixelIndex = y * width + x;\n            const imageDataOffset = pixelIndex * 4;\n            if (paletteIndex >= rgbaPalette.length) {\n                imageDataArray[imageDataOffset] = 0;\n                imageDataArray[imageDataOffset + 1] = 0;\n                imageDataArray[imageDataOffset + 2] = 0;\n                imageDataArray[imageDataOffset + 3] = 0;\n            }\n            else {\n                const color = rgbaPalette[paletteIndex];\n                imageDataArray[imageDataOffset] = color.r;\n                imageDataArray[imageDataOffset + 1] = color.g;\n                imageDataArray[imageDataOffset + 2] = color.b;\n                imageDataArray[imageDataOffset + 3] = color.a;\n            }\n        });\n        return new ImageData(imageDataArray.subarray(0, 4 * firstOds.width * firstOds.height), firstOds.width, firstOds.height);\n    }\n    // https://stackoverflow.com/questions/21264648/javascript-convert-yuv-to-rgb\n    ycrcbToRgba(palette) {\n        const y = palette.luminance;\n        const cb = palette.colorDifferenceBlue;\n        const cr = palette.colorDifferenceRed;\n        const r = this.clamp(Math.floor(y + 1.4075 * (cr - 128)), 0, 255);\n        const g = this.clamp(Math.floor(y - 0.3455 * (cb - 128) - 0.7169 * (cr - 128)), 0, 255);\n        const b = this.clamp(Math.floor(y + 1.779 * (cb - 128)), 0, 255);\n        return { r, g, b, a: palette.transparency };\n    }\n    clamp(number, min, max) {\n        return Math.max(min, Math.min(max, number));\n    }\n}\nexports.DisplaySet = DisplaySet;\nclass DisplaySetParser {\n    constructor() {\n        this.windowDefinitionSegments = [];\n        this.paletteDefinitionSegments = [];\n        this.objectDefinitionSegments = [];\n        this.ready = false;\n    }\n    next() {\n        this.ready = false;\n        return this.lastDisplaySet;\n    }\n    consume(buffer) {\n        const reader = new buffer_1.BufferReader(buffer);\n        if (this.header) {\n            switch (this.header.segmentType) {\n                case segment_1.SegmentType.pcs:\n                    if (this.presentationCompositionSegment !== undefined) {\n                        throw new Error(`Unexpected PDS`);\n                    }\n                    this.presentationCompositionSegment = parsePcsSegment(reader, this.header);\n                    break;\n                case segment_1.SegmentType.wds:\n                    if (this.presentationCompositionSegment === undefined) {\n                        throw new Error(`Unexpected WDS`);\n                    }\n                    this.windowDefinitionSegments.push(parseWdsSegment(reader, this.header));\n                    break;\n                case segment_1.SegmentType.pds:\n                    if (this.presentationCompositionSegment === undefined) {\n                        throw new Error(`Unexpected PDS`);\n                    }\n                    this.paletteDefinitionSegments.push(parsePdsSegment(reader, this.header));\n                    break;\n                case segment_1.SegmentType.ods:\n                    if (this.presentationCompositionSegment === undefined) {\n                        throw new Error(`Unexpected ODS`);\n                    }\n                    const ods = parseOdsSegment(reader, this.header);\n                    this.objectDefinitionSegments.push(ods);\n                    break;\n                case segment_1.SegmentType.end:\n                    if (this.presentationCompositionSegment === undefined) {\n                        throw new Error(`Unexpected end segment`);\n                    }\n                    const endDefinitionSegment = { header: this.header };\n                    this.lastDisplaySet = new DisplaySet(this.presentationCompositionSegment, this.windowDefinitionSegments, this.paletteDefinitionSegments, this.objectDefinitionSegments, endDefinitionSegment, this.lastDisplaySet);\n                    this.ready = true;\n                    this.presentationCompositionSegment = undefined;\n                    this.windowDefinitionSegments = [];\n                    this.paletteDefinitionSegments = [];\n                    this.objectDefinitionSegments = [];\n                    break;\n                default:\n                    throw new Error(`Unknown segment type: ${this.header.segmentType}`);\n            }\n            this.header = undefined;\n            return 13;\n        }\n        else {\n            const magicNumber = reader.readHex(2);\n            if (magicNumber !== pgMagicNumber) {\n                throw new Error(`Invalid magic number: ${magicNumber}`);\n            }\n            const presentationTimestamp = reader.readHex(4);\n            const decodingTimestamp = reader.readHex(4);\n            const segmentType = (0, segment_1.segmentTypeFromByte)(reader.readHex(1));\n            const segmentSize = reader.readHex(2);\n            this.header = { presentationTimestamp, decodingTimestamp, segmentType, segmentSize };\n            return segmentSize;\n        }\n    }\n}\nfunction parsePcsSegment(reader, header) {\n    const limit = reader.index + header.segmentSize;\n    const width = reader.readHex(2, limit);\n    const height = reader.readHex(2, limit);\n    reader.readHex(1); // ignore frame rate\n    const compositionNumber = reader.readHex(2, limit);\n    const compositionState = (0, segment_1.compositionStateFromByte)(reader.readHex(1, limit));\n    const paletteUpdateFlag = (0, segment_1.paletteUpdateFlagFromByte)(reader.readHex(1, limit));\n    const paletteId = reader.readHex(1, limit);\n    const compositionObjectCount = reader.readHex(1, limit);\n    const objectId = reader.readHex(2, limit);\n    const windowId = reader.readHex(1, limit);\n    const objectCroppedFlag = (0, segment_1.objectCroppedFlagFromByte)(reader.readHex(1, limit));\n    const objectHorizontalPosition = reader.readHex(2, limit);\n    const objectVerticalPosition = reader.readHex(2, limit);\n    const objectCroppingHorizontalPosition = reader.readHex(2, limit);\n    const objectCroppingVerticalPosition = reader.readHex(2, limit);\n    const objectCroppingWidth = reader.readHex(2, limit);\n    const objectCroppingHeightPosition = reader.readHex(2, limit);\n    return {\n        header,\n        width,\n        height,\n        compositionNumber,\n        compositionState,\n        paletteUpdateFlag,\n        paletteId,\n        compositionObjectCount,\n        objectId,\n        windowId,\n        objectCroppedFlag,\n        objectHorizontalPosition,\n        objectVerticalPosition,\n        objectCroppingHorizontalPosition,\n        objectCroppingVerticalPosition,\n        objectCroppingWidth,\n        objectCroppingHeightPosition,\n    };\n}\nfunction parseWdsSegment(reader, header) {\n    const limit = reader.index + header.segmentSize;\n    const windowCount = reader.readHex(1, limit);\n    const windowDefinitions = [];\n    for (let i = 0; i < windowCount; ++i) {\n        const windowId = reader.readHex(1, limit);\n        const windowHorizontalPosition = reader.readHex(2, limit);\n        const windowVerticalPosition = reader.readHex(2, limit);\n        const windowWidth = reader.readHex(2, limit);\n        const windowHeight = reader.readHex(2, limit);\n        windowDefinitions.push({\n            windowId,\n            windowHorizontalPosition,\n            windowVerticalPosition,\n            windowWidth,\n            windowHeight,\n        });\n    }\n    return {\n        header,\n        windowCount,\n        windowDefinitions,\n    };\n}\nfunction parsePdsSegment(reader, header) {\n    const limit = reader.index + header.segmentSize;\n    const paletteId = reader.readHex(1, limit);\n    const paletteVersionNumber = reader.readHex(1, limit);\n    const paletteEntries = [];\n    while (reader.index < limit) {\n        const paletteEntryId = reader.readHex(1, limit);\n        const luminance = reader.readHex(1, limit);\n        const colorDifferenceRed = reader.readHex(1, limit);\n        const colorDifferenceBlue = reader.readHex(1, limit);\n        const transparency = reader.readHex(1, limit);\n        paletteEntries.push({ paletteEntryId, luminance, colorDifferenceRed, colorDifferenceBlue, transparency });\n    }\n    return {\n        header,\n        paletteId,\n        paletteVersionNumber,\n        paletteEntries,\n    };\n}\nfunction parseOdsSegment(reader, header) {\n    const objectId = reader.readHex(2);\n    const objectVersionNumber = reader.readHex(1);\n    const lastInSequenceFlag = (0, segment_1.lastInSequenceFlagFromByte)(reader.readHex(1));\n    const objectDataLength = reader.readHex(3);\n    let width;\n    let height;\n    let objectData;\n    if (lastInSequenceFlag === segment_1.LastInSequenceFlag.firstInSequence ||\n        lastInSequenceFlag === segment_1.LastInSequenceFlag.firstAndLastInSequence) {\n        width = reader.readHex(2);\n        height = reader.readHex(2);\n        objectData = reader.readBuffer(objectDataLength - 4);\n    }\n    else {\n        objectData = reader.readBuffer(objectDataLength);\n    }\n    return {\n        header,\n        objectId,\n        objectVersionNumber,\n        lastInSequenceFlag,\n        objectDataLength,\n        width,\n        height,\n        objectData: objectData,\n    };\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.lastInSequenceFlagFromByte = exports.LastInSequenceFlag = exports.objectCroppedFlagFromByte = exports.paletteUpdateFlagFromByte = exports.compositionStateFromByte = exports.CompositionState = exports.segmentTypeFromByte = exports.SegmentType = void 0;\nvar SegmentType;\n(function (SegmentType) {\n    SegmentType[SegmentType[\"pds\"] = 20] = \"pds\";\n    SegmentType[SegmentType[\"ods\"] = 21] = \"ods\";\n    SegmentType[SegmentType[\"pcs\"] = 22] = \"pcs\";\n    SegmentType[SegmentType[\"wds\"] = 23] = \"wds\";\n    SegmentType[SegmentType[\"end\"] = 128] = \"end\";\n})(SegmentType = exports.SegmentType || (exports.SegmentType = {}));\nconst segmentTypeValues = Object.values(SegmentType);\nfunction segmentTypeFromByte(byte) {\n    for (const type of segmentTypeValues) {\n        if (byte === type) {\n            return type;\n        }\n    }\n    throw new Error(`Invalid segment type byte: ${byte}`);\n}\nexports.segmentTypeFromByte = segmentTypeFromByte;\nvar CompositionState;\n(function (CompositionState) {\n    CompositionState[CompositionState[\"normal\"] = 0] = \"normal\";\n    CompositionState[CompositionState[\"acquisitionState\"] = 64] = \"acquisitionState\";\n    CompositionState[CompositionState[\"epochStart\"] = 128] = \"epochStart\";\n})(CompositionState = exports.CompositionState || (exports.CompositionState = {}));\nconst compositionStateValues = Object.values(CompositionState);\nfunction compositionStateFromByte(byte) {\n    for (const state of compositionStateValues) {\n        if (byte === state) {\n            return state;\n        }\n    }\n    throw new Error(`Invalid composition state byte: ${byte}`);\n}\nexports.compositionStateFromByte = compositionStateFromByte;\nfunction paletteUpdateFlagFromByte(byte) {\n    switch (byte) {\n        case 0:\n            return false;\n        case 128:\n            return true;\n        default:\n            throw new Error(`Invalid palette update flag byte: ${byte}`);\n    }\n}\nexports.paletteUpdateFlagFromByte = paletteUpdateFlagFromByte;\nfunction objectCroppedFlagFromByte(byte) {\n    switch (byte) {\n        case 0:\n            return false;\n        case 64:\n            return true;\n        default:\n            throw new Error(`Invalid object cropped flag byte: ${byte}`);\n    }\n}\nexports.objectCroppedFlagFromByte = objectCroppedFlagFromByte;\nvar LastInSequenceFlag;\n(function (LastInSequenceFlag) {\n    LastInSequenceFlag[LastInSequenceFlag[\"lastInSequence\"] = 64] = \"lastInSequence\";\n    LastInSequenceFlag[LastInSequenceFlag[\"firstInSequence\"] = 128] = \"firstInSequence\";\n    LastInSequenceFlag[LastInSequenceFlag[\"firstAndLastInSequence\"] = 192] = \"firstAndLastInSequence\";\n})(LastInSequenceFlag = exports.LastInSequenceFlag || (exports.LastInSequenceFlag = {}));\nconst lastInSequenceFlagValues = Object.values(LastInSequenceFlag);\nfunction lastInSequenceFlagFromByte(byte) {\n    for (const flag of lastInSequenceFlagValues) {\n        if (byte === flag) {\n            return flag;\n        }\n    }\n    throw new Error(`Invalid last in sequence flag byte: ${byte}`);\n}\nexports.lastInSequenceFlagFromByte = lastInSequenceFlagFromByte;\n","function _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n  return arr2;\n}\nmodule.exports = _arrayLikeToArray, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\nmodule.exports = _classCallCheck, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var toPropertyKey = require(\"./toPropertyKey.js\");\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, toPropertyKey(descriptor.key), descriptor);\n  }\n}\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}\nmodule.exports = _createClass, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var unsupportedIterableToArray = require(\"./unsupportedIterableToArray.js\");\nfunction _createForOfIteratorHelper(o, allowArrayLike) {\n  var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"];\n  if (!it) {\n    if (Array.isArray(o) || (it = unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n      if (it) o = it;\n      var i = 0;\n      var F = function F() {};\n      return {\n        s: F,\n        n: function n() {\n          if (i >= o.length) return {\n            done: true\n          };\n          return {\n            done: false,\n            value: o[i++]\n          };\n        },\n        e: function e(_e) {\n          throw _e;\n        },\n        f: F\n      };\n    }\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n  var normalCompletion = true,\n    didErr = false,\n    err;\n  return {\n    s: function s() {\n      it = it.call(o);\n    },\n    n: function n() {\n      var step = it.next();\n      normalCompletion = step.done;\n      return step;\n    },\n    e: function e(_e2) {\n      didErr = true;\n      err = _e2;\n    },\n    f: function f() {\n      try {\n        if (!normalCompletion && it[\"return\"] != null) it[\"return\"]();\n      } finally {\n        if (didErr) throw err;\n      }\n    }\n  };\n}\nmodule.exports = _createForOfIteratorHelper, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var _typeof = require(\"./typeof.js\")[\"default\"];\nfunction _regeneratorRuntime() {\n  \"use strict\"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */\n  module.exports = _regeneratorRuntime = function _regeneratorRuntime() {\n    return e;\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;\n  var t,\n    e = {},\n    r = Object.prototype,\n    n = r.hasOwnProperty,\n    o = Object.defineProperty || function (t, e, r) {\n      t[e] = r.value;\n    },\n    i = \"function\" == typeof Symbol ? Symbol : {},\n    a = i.iterator || \"@@iterator\",\n    c = i.asyncIterator || \"@@asyncIterator\",\n    u = i.toStringTag || \"@@toStringTag\";\n  function define(t, e, r) {\n    return Object.defineProperty(t, e, {\n      value: r,\n      enumerable: !0,\n      configurable: !0,\n      writable: !0\n    }), t[e];\n  }\n  try {\n    define({}, \"\");\n  } catch (t) {\n    define = function define(t, e, r) {\n      return t[e] = r;\n    };\n  }\n  function wrap(t, e, r, n) {\n    var i = e && e.prototype instanceof Generator ? e : Generator,\n      a = Object.create(i.prototype),\n      c = new Context(n || []);\n    return o(a, \"_invoke\", {\n      value: makeInvokeMethod(t, r, c)\n    }), a;\n  }\n  function tryCatch(t, e, r) {\n    try {\n      return {\n        type: \"normal\",\n        arg: t.call(e, r)\n      };\n    } catch (t) {\n      return {\n        type: \"throw\",\n        arg: t\n      };\n    }\n  }\n  e.wrap = wrap;\n  var h = \"suspendedStart\",\n    l = \"suspendedYield\",\n    f = \"executing\",\n    s = \"completed\",\n    y = {};\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n  var p = {};\n  define(p, a, function () {\n    return this;\n  });\n  var d = Object.getPrototypeOf,\n    v = d && d(d(values([])));\n  v && v !== r && n.call(v, a) && (p = v);\n  var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p);\n  function defineIteratorMethods(t) {\n    [\"next\", \"throw\", \"return\"].forEach(function (e) {\n      define(t, e, function (t) {\n        return this._invoke(e, t);\n      });\n    });\n  }\n  function AsyncIterator(t, e) {\n    function invoke(r, o, i, a) {\n      var c = tryCatch(t[r], t, o);\n      if (\"throw\" !== c.type) {\n        var u = c.arg,\n          h = u.value;\n        return h && \"object\" == _typeof(h) && n.call(h, \"__await\") ? e.resolve(h.__await).then(function (t) {\n          invoke(\"next\", t, i, a);\n        }, function (t) {\n          invoke(\"throw\", t, i, a);\n        }) : e.resolve(h).then(function (t) {\n          u.value = t, i(u);\n        }, function (t) {\n          return invoke(\"throw\", t, i, a);\n        });\n      }\n      a(c.arg);\n    }\n    var r;\n    o(this, \"_invoke\", {\n      value: function value(t, n) {\n        function callInvokeWithMethodAndArg() {\n          return new e(function (e, r) {\n            invoke(t, n, e, r);\n          });\n        }\n        return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg();\n      }\n    });\n  }\n  function makeInvokeMethod(e, r, n) {\n    var o = h;\n    return function (i, a) {\n      if (o === f) throw new Error(\"Generator is already running\");\n      if (o === s) {\n        if (\"throw\" === i) throw a;\n        return {\n          value: t,\n          done: !0\n        };\n      }\n      for (n.method = i, n.arg = a;;) {\n        var c = n.delegate;\n        if (c) {\n          var u = maybeInvokeDelegate(c, n);\n          if (u) {\n            if (u === y) continue;\n            return u;\n          }\n        }\n        if (\"next\" === n.method) n.sent = n._sent = n.arg;else if (\"throw\" === n.method) {\n          if (o === h) throw o = s, n.arg;\n          n.dispatchException(n.arg);\n        } else \"return\" === n.method && n.abrupt(\"return\", n.arg);\n        o = f;\n        var p = tryCatch(e, r, n);\n        if (\"normal\" === p.type) {\n          if (o = n.done ? s : l, p.arg === y) continue;\n          return {\n            value: p.arg,\n            done: n.done\n          };\n        }\n        \"throw\" === p.type && (o = s, n.method = \"throw\", n.arg = p.arg);\n      }\n    };\n  }\n  function maybeInvokeDelegate(e, r) {\n    var n = r.method,\n      o = e.iterator[n];\n    if (o === t) return r.delegate = null, \"throw\" === n && e.iterator[\"return\"] && (r.method = \"return\", r.arg = t, maybeInvokeDelegate(e, r), \"throw\" === r.method) || \"return\" !== n && (r.method = \"throw\", r.arg = new TypeError(\"The iterator does not provide a '\" + n + \"' method\")), y;\n    var i = tryCatch(o, e.iterator, r.arg);\n    if (\"throw\" === i.type) return r.method = \"throw\", r.arg = i.arg, r.delegate = null, y;\n    var a = i.arg;\n    return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, \"return\" !== r.method && (r.method = \"next\", r.arg = t), r.delegate = null, y) : a : (r.method = \"throw\", r.arg = new TypeError(\"iterator result is not an object\"), r.delegate = null, y);\n  }\n  function pushTryEntry(t) {\n    var e = {\n      tryLoc: t[0]\n    };\n    1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e);\n  }\n  function resetTryEntry(t) {\n    var e = t.completion || {};\n    e.type = \"normal\", delete e.arg, t.completion = e;\n  }\n  function Context(t) {\n    this.tryEntries = [{\n      tryLoc: \"root\"\n    }], t.forEach(pushTryEntry, this), this.reset(!0);\n  }\n  function values(e) {\n    if (e || \"\" === e) {\n      var r = e[a];\n      if (r) return r.call(e);\n      if (\"function\" == typeof e.next) return e;\n      if (!isNaN(e.length)) {\n        var o = -1,\n          i = function next() {\n            for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next;\n            return next.value = t, next.done = !0, next;\n          };\n        return i.next = i;\n      }\n    }\n    throw new TypeError(_typeof(e) + \" is not iterable\");\n  }\n  return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, \"constructor\", {\n    value: GeneratorFunctionPrototype,\n    configurable: !0\n  }), o(GeneratorFunctionPrototype, \"constructor\", {\n    value: GeneratorFunction,\n    configurable: !0\n  }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, \"GeneratorFunction\"), e.isGeneratorFunction = function (t) {\n    var e = \"function\" == typeof t && t.constructor;\n    return !!e && (e === GeneratorFunction || \"GeneratorFunction\" === (e.displayName || e.name));\n  }, e.mark = function (t) {\n    return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, \"GeneratorFunction\")), t.prototype = Object.create(g), t;\n  }, e.awrap = function (t) {\n    return {\n      __await: t\n    };\n  }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () {\n    return this;\n  }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) {\n    void 0 === i && (i = Promise);\n    var a = new AsyncIterator(wrap(t, r, n, o), i);\n    return e.isGeneratorFunction(r) ? a : a.next().then(function (t) {\n      return t.done ? t.value : a.next();\n    });\n  }, defineIteratorMethods(g), define(g, u, \"Generator\"), define(g, a, function () {\n    return this;\n  }), define(g, \"toString\", function () {\n    return \"[object Generator]\";\n  }), e.keys = function (t) {\n    var e = Object(t),\n      r = [];\n    for (var n in e) r.push(n);\n    return r.reverse(), function next() {\n      for (; r.length;) {\n        var t = r.pop();\n        if (t in e) return next.value = t, next.done = !1, next;\n      }\n      return next.done = !0, next;\n    };\n  }, e.values = values, Context.prototype = {\n    constructor: Context,\n    reset: function reset(e) {\n      if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = \"next\", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) \"t\" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t);\n    },\n    stop: function stop() {\n      this.done = !0;\n      var t = this.tryEntries[0].completion;\n      if (\"throw\" === t.type) throw t.arg;\n      return this.rval;\n    },\n    dispatchException: function dispatchException(e) {\n      if (this.done) throw e;\n      var r = this;\n      function handle(n, o) {\n        return a.type = \"throw\", a.arg = e, r.next = n, o && (r.method = \"next\", r.arg = t), !!o;\n      }\n      for (var o = this.tryEntries.length - 1; o >= 0; --o) {\n        var i = this.tryEntries[o],\n          a = i.completion;\n        if (\"root\" === i.tryLoc) return handle(\"end\");\n        if (i.tryLoc <= this.prev) {\n          var c = n.call(i, \"catchLoc\"),\n            u = n.call(i, \"finallyLoc\");\n          if (c && u) {\n            if (this.prev < i.catchLoc) return handle(i.catchLoc, !0);\n            if (this.prev < i.finallyLoc) return handle(i.finallyLoc);\n          } else if (c) {\n            if (this.prev < i.catchLoc) return handle(i.catchLoc, !0);\n          } else {\n            if (!u) throw new Error(\"try statement without catch or finally\");\n            if (this.prev < i.finallyLoc) return handle(i.finallyLoc);\n          }\n        }\n      }\n    },\n    abrupt: function abrupt(t, e) {\n      for (var r = this.tryEntries.length - 1; r >= 0; --r) {\n        var o = this.tryEntries[r];\n        if (o.tryLoc <= this.prev && n.call(o, \"finallyLoc\") && this.prev < o.finallyLoc) {\n          var i = o;\n          break;\n        }\n      }\n      i && (\"break\" === t || \"continue\" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null);\n      var a = i ? i.completion : {};\n      return a.type = t, a.arg = e, i ? (this.method = \"next\", this.next = i.finallyLoc, y) : this.complete(a);\n    },\n    complete: function complete(t, e) {\n      if (\"throw\" === t.type) throw t.arg;\n      return \"break\" === t.type || \"continue\" === t.type ? this.next = t.arg : \"return\" === t.type ? (this.rval = this.arg = t.arg, this.method = \"return\", this.next = \"end\") : \"normal\" === t.type && e && (this.next = e), y;\n    },\n    finish: function finish(t) {\n      for (var e = this.tryEntries.length - 1; e >= 0; --e) {\n        var r = this.tryEntries[e];\n        if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y;\n      }\n    },\n    \"catch\": function _catch(t) {\n      for (var e = this.tryEntries.length - 1; e >= 0; --e) {\n        var r = this.tryEntries[e];\n        if (r.tryLoc === t) {\n          var n = r.completion;\n          if (\"throw\" === n.type) {\n            var o = n.arg;\n            resetTryEntry(r);\n          }\n          return o;\n        }\n      }\n      throw new Error(\"illegal catch attempt\");\n    },\n    delegateYield: function delegateYield(e, r, n) {\n      return this.delegate = {\n        iterator: values(e),\n        resultName: r,\n        nextLoc: n\n      }, \"next\" === this.method && (this.arg = t), y;\n    }\n  }, e;\n}\nmodule.exports = _regeneratorRuntime, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var _typeof = require(\"./typeof.js\")[\"default\"];\nfunction _toPrimitive(input, hint) {\n  if (_typeof(input) !== \"object\" || input === null) return input;\n  var prim = input[Symbol.toPrimitive];\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (_typeof(res) !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (hint === \"string\" ? String : Number)(input);\n}\nmodule.exports = _toPrimitive, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var _typeof = require(\"./typeof.js\")[\"default\"];\nvar toPrimitive = require(\"./toPrimitive.js\");\nfunction _toPropertyKey(arg) {\n  var key = toPrimitive(arg, \"string\");\n  return _typeof(key) === \"symbol\" ? key : String(key);\n}\nmodule.exports = _toPropertyKey, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _typeof(o) {\n  \"@babel/helpers - typeof\";\n\n  return (module.exports = _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) {\n    return typeof o;\n  } : function (o) {\n    return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o;\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports), _typeof(o);\n}\nmodule.exports = _typeof, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var arrayLikeToArray = require(\"./arrayLikeToArray.js\");\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return arrayLikeToArray(o, minLen);\n}\nmodule.exports = _unsupportedIterableToArray, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","// TODO(Babel 8): Remove this file.\n\nvar runtime = require(\"../helpers/regeneratorRuntime\")();\nmodule.exports = runtime;\n\n// Copied from https://github.com/facebook/regenerator/blob/main/packages/runtime/runtime.js#L736=\ntry {\n  regeneratorRuntime = runtime;\n} catch (accidentalStrictMode) {\n  if (typeof globalThis === \"object\") {\n    globalThis.regeneratorRuntime = runtime;\n  } else {\n    Function(\"r\", \"regeneratorRuntime = r\")(runtime);\n  }\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\nexport default function _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n      args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n      _next(undefined);\n    });\n  };\n}","import { DisplaySet, parseDisplaySets } from 'pgs-parser';\n\n// OffscreenCanvas not in lib.dom.d.ts\n// @ts-ignore\nfunction parse(fileStream: ReadableStream, canvas: OffscreenCanvas) {\n    let currentImageDisplaySet: DisplaySet | undefined;\n    let imageDataArray: Uint8ClampedArray | undefined;\n\n    fileStream.pipeThrough(parseDisplaySets()).pipeTo(\n        new WritableStream<DisplaySet>({\n            close() {\n                postMessage({\n                    command: 'finished',\n                });\n            },\n            abort(error) {\n                postMessage({\n                    command: 'error',\n                    error,\n                });\n            },\n            async write(displaySet, controller) {\n                if (displaySet.objectDefinitionSegments.length > 0) {\n                    if (currentImageDisplaySet === undefined) {\n                        currentImageDisplaySet = displaySet;\n                    }\n                } else if (currentImageDisplaySet !== undefined) {\n                    const screenWidth = currentImageDisplaySet.presentationCompositionSegment.width;\n                    const screenHeight = currentImageDisplaySet.presentationCompositionSegment.height;\n                    imageDataArray =\n                        imageDataArray === undefined || imageDataArray.length < screenHeight * screenWidth * 4\n                            ? new Uint8ClampedArray(screenWidth * screenHeight * 4)\n                            : imageDataArray;\n                    const imageData = currentImageDisplaySet.imageData(imageDataArray);\n                    canvas.width = imageData.width;\n                    canvas.height = imageData.height;\n                    const context = canvas.getContext('2d')!;\n                    context.putImageData(imageData, 0, 0);\n                    postMessage({\n                        command: 'subtitle',\n                        imageBlob: await canvas.convertToBlob({ type: 'image/png' }),\n                        subtitle: {\n                            start:\n                                currentImageDisplaySet.objectDefinitionSegments[0].header.presentationTimestamp / 90 ??\n                                0,\n                            end: displaySet.endDefinitionSegment.header.presentationTimestamp / 90,\n                            text: '',\n                            textImage: {\n                                image: {\n                                    width: imageData.width,\n                                    height: imageData.height,\n                                },\n                                screen: {\n                                    width: currentImageDisplaySet.presentationCompositionSegment.width,\n                                    height: currentImageDisplaySet.presentationCompositionSegment.height,\n                                },\n                            },\n                        },\n                    });\n\n                    currentImageDisplaySet = undefined;\n                }\n            },\n        })\n    );\n}\n\nonmessage = async (e: MessageEvent) => {\n    const { fileStream, canvas } = e.data;\n    parse(fileStream, canvas);\n};\n"],"names":["Object","defineProperty","exports","value","BufferReader","CompositeBufferReader","CompositeBuffer","Uint8ArrayBuffer","buffer","this","length","index","start","end","subarray","buffers","previousBuffersLength","bufferIndex","at","Error","chunks","startBufferIndex","Math","max","endBufferIndex","min","push","bytes","accumulated","shift","required","unshift","map","c","_index","limit","undefined","number","digit","from","i","parser_1","require","enumerable","get","parseDisplaySets","segment_1","DisplaySet","buffer_1","parser","DisplaySetParser","accumulatedBuffer","requestedBytes","TransformStream","transform","chunk","controller","add","consume","read","ready","enqueue","next","flush","presentationCompositionSegment","windowDefinitionSegments","paletteDefinitionSegments","objectDefinitionSegments","endDefinitionSegment","previousDisplaySet","find","ods","lastInSequenceFlag","LastInSequenceFlag","firstInSequence","firstAndLastInSequence","paletteId","pds","s","compositionState","CompositionState","normal","paletteDefinitionSegment","firstOds","width","height","imageDataArray","Uint8ClampedArray","rgbaPalette","paletteEntries","palette","ycrcbToRgba","encodedBuffer","callback","encodedIndex","decodedLineIndex","currentLine","encodedLength","firstByte","runLength","color","increment","secondByte","thirdByte","x","rleDecode","objectData","y","paletteIndex","imageDataOffset","r","g","b","a","ImageData","luminance","cb","colorDifferenceBlue","cr","colorDifferenceRed","clamp","floor","transparency","lastDisplaySet","reader","header","segmentType","SegmentType","pcs","segmentSize","readHex","compositionNumber","compositionStateFromByte","paletteUpdateFlag","paletteUpdateFlagFromByte","compositionObjectCount","objectId","windowId","objectCroppedFlag","objectCroppedFlagFromByte","objectHorizontalPosition","objectVerticalPosition","objectCroppingHorizontalPosition","objectCroppingVerticalPosition","objectCroppingWidth","objectCroppingHeightPosition","parsePcsSegment","wds","windowCount","windowDefinitions","windowHorizontalPosition","windowVerticalPosition","windowWidth","windowHeight","parseWdsSegment","paletteVersionNumber","paletteEntryId","parsePdsSegment","objectVersionNumber","lastInSequenceFlagFromByte","objectDataLength","readBuffer","parseOdsSegment","magicNumber","presentationTimestamp","decodingTimestamp","segmentTypeFromByte","segmentTypeValues","values","byte","type","compositionStateValues","state","lastInSequenceFlagValues","flag","module","arr","len","arr2","Array","__esModule","instance","Constructor","TypeError","toPropertyKey","_defineProperties","target","props","descriptor","configurable","writable","key","protoProps","staticProps","prototype","unsupportedIterableToArray","o","allowArrayLike","it","Symbol","iterator","isArray","F","n","done","e","_e","f","err","normalCompletion","didErr","call","step","_e2","_typeof","_regeneratorRuntime","t","hasOwnProperty","asyncIterator","u","toStringTag","define","wrap","Generator","create","Context","makeInvokeMethod","tryCatch","arg","h","l","GeneratorFunction","GeneratorFunctionPrototype","p","d","getPrototypeOf","v","defineIteratorMethods","forEach","_invoke","AsyncIterator","invoke","resolve","__await","then","callInvokeWithMethodAndArg","method","delegate","maybeInvokeDelegate","sent","_sent","dispatchException","abrupt","resultName","nextLoc","pushTryEntry","tryLoc","catchLoc","finallyLoc","afterLoc","tryEntries","resetTryEntry","completion","reset","isNaN","displayName","isGeneratorFunction","constructor","name","mark","setPrototypeOf","__proto__","awrap","async","Promise","keys","reverse","pop","prev","charAt","slice","stop","rval","handle","complete","finish","delegateYield","input","hint","prim","toPrimitive","res","String","Number","arrayLikeToArray","minLen","toString","test","runtime","regeneratorRuntime","accidentalStrictMode","globalThis","Function","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","getter","definition","obj","prop","asyncGeneratorStep","gen","reject","_next","_throw","info","error","_asyncToGenerator","fn","self","args","arguments","apply","parse","fileStream","canvas","currentImageDisplaySet","pipeThrough","pipeTo","WritableStream","close","postMessage","command","abort","write","displaySet","screenWidth","screenHeight","imageData","getContext","putImageData","convertToBlob","text","textImage","image","screen","imageBlob","subtitle","onmessage","data"],"sourceRoot":""}